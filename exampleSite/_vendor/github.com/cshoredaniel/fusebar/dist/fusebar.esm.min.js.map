{"version":3,"file":"fusebar.esm.min.js","sources":["../src/index.js"],"sourcesContent":["/* global indexurl Fuse */\n\nvar summaryInclude = 1000\nvar fuseOptions = { // See Fuse.js for details\n  distance: 1000,\n  findAllMatches: true,\n  shouldSort: true,\n  includeMatches: true,\n  minMatchCharLength: 1,\n  threshold: 0.5,  // default of 0.6 matches too much\n  tokenize: false,\n  keys: [{\n    name: 'title',\n    weight: 0.3\n  },\n  {\n    name: 'content',\n    weight: 0.4\n  },\n  {\n    name: 'tags',\n    weight: 0.1\n  },\n  {\n    name: 'categories',\n    weight: 0.1\n  }\n  ]\n}\n\nfunction doCloseSearch() { // eslint-disable-line no-unused-vars\n  if (document.getElementById('search-results')) {\n    document.getElementById('search-results').style = 'display: none; visibility: hidden;'\n    document.getElementById('search-results').innerHTML = '<h2>Search Results</h2>'\n  }\n}\n\nfunction doSearch() { // eslint-disable-line no-unused-vars\n  var searchQuery = document.search_form.s.value\n  if (searchQuery) {\n    if (document.getElementById('search-query')) {\n      document.getElementById('search-results').innerHTML = '<h2>Search Results</h2>'\n\n      document.getElementById('search-results').style = 'display: block; visibility: visible;'\n      var searchFuseOptions = fuseOptions\n      searchFuseOptions.minMatchCharLength = searchQuery.length * 0.8\n      executeSearch(searchQuery, searchFuseOptions)\n    }\n  } else {\n    var para = document.createElement('p')\n    para.innerText = 'Please enter a word or phrase above'\n    if (document.getElementById('search-results')) {\n      document.getElementById('search-results').appendChild(para)\n      document.getElementById('search-results').style = 'display: block; visibility: visible;'\n    }\n  }\n  return false\n}\n\nfunction executeSearch(searchQuery, searchFuseOptions) {\n  var request = new XMLHttpRequest()\n  request.open('GET', indexurl, true)\n  request.onload = function () {\n    if (request.status >= 200 && request.status < 400) {\n      var jsonprep = request.responseText.replace(/$/, ' ')\n      var pages = JSON.parse(jsonprep)\n      var fuse = new Fuse(pages, searchFuseOptions)\n      var result = fuse.search(searchQuery)\n      if (result.length > 0) {\n        populateResults(result, searchQuery)\n      } else {\n        var para = document.createElement('p')\n        para.innerHTML = 'No matches found'\n        document.getElementById('search-results').appendChild(para)\n      }\n    } else {\n      console.log('fusebar had error ' + request.status + ' on ' + indexurl)\n    }\n  }\n  request.onerror = function () {\n    console.log('fusebar search connection error ' + request.status)\n  }\n  request.send()\n}\n\nfunction createMark(value) {\n  var markel = document.createElement('mark')\n  var spanel = document.createElement('span')\n  spanel.setAttribute('class', 'mark')\n  spanel.innerHTML = value\n  markel.appendChild(spanel)\n\n  return markel\n}\n\nfunction markMatches(matches) {\n  var newResult = {}\n  matches.forEach(function (items, num) { // eslint-disable-line no-unused-vars\n    var newElement = document.createElement('div')\n\n    var prevIndexEnd = 0\n\n    items.indices.forEach(function (indexpair, indexnum) { // eslint-disable-line no-unused-vars\n      if (items.key == 'content' && items.value.length > summaryInclude) {\n        items.value = items.value.substring(0, summaryInclude)\n      }\n\n      var matchString = items.value.substring(indexpair[0], indexpair[1] + 1)\n      if (indexpair[0] >= prevIndexEnd) {\n        var newSubString = document.createElement('span')\n        newSubString.innerHTML = items.value.substring(prevIndexEnd, indexpair[0])\n        newElement.appendChild(newSubString)\n      }\n\n      newElement.appendChild(createMark(matchString))\n\n      prevIndexEnd = indexpair[1] + 1\n    })\n\n    if ((prevIndexEnd) < items.value.length) {\n      newElement.appendChild(\n        document.createTextNode(\n          items.value.substring(prevIndexEnd, items.value.length)\n        )\n      )\n    }\n\n    newResult[items.key] = {\n      'element': newElement,\n      'original_value': items.value\n    }\n  })\n\n  return newResult\n}\n\nfunction populateResults(results, searchQuery) { // eslint-disable-line no-unused-vars\n  results.forEach(function (result, resnum) { // eslint-disable-line no-unused-vars\n    var resultElement = document.createElement('div')\n    resultElement.setAttribute('class', 'search-result')\n    resultElement.id = 'search-result-' + resnum.toString()\n    if (result.item.content && result.item.content.length > summaryInclude) {\n      result.item.content = result.item.content.substring(0, summaryInclude)\n    }\n    var resultMap = markMatches(result.matches)\n    var resultKeys = ['Title', 'Content', 'Tags', 'Categories']\n    resultKeys.forEach(function (key) {\n\n      var lowerKey = key.toString().toLowerCase()\n      var keyElement\n      var resultTitleLink\n\n      if (lowerKey == 'title') {\n        keyElement = document.createElement('h4')\n        keyElement.setAttribute('class', 'search-result-title')\n        resultTitleLink = document.createElement('a')\n        resultTitleLink.setAttribute('href', result.item.permalink)\n      }\n\n      if (typeof resultMap[lowerKey] !== 'undefined') {\n        if (lowerKey == 'title') {\n          resultTitleLink.innerHTML = resultMap[lowerKey].element.innerHTML\n          if (!resultMap[lowerKey].element.innerHTML || resultMap[lowerKey].element.innerHTML == '') {\n            resultTitleLink.innnerHTML = 'Untitled'\n          }\n        } else if (lowerKey == 'content') {\n          keyElement = resultMap.content.element\n          keyElement.setAttribute('class', 'search-result-content')\n        } else {\n          var keyElVal\n          keyElement = document.createElement('div')\n          keyElement.setAttribute('class', 'search-result-' + lowerKey)\n          keyElement.appendChild(document.createTextNode(key + ':  '))\n          var firstVal = true\n          result.item[lowerKey].forEach(function (tcval, tckey) { // eslint-disable-line no-unused-vars\n            if (!firstVal) {\n              keyElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            if (tcval == resultMap[lowerKey].original_value) {\n              keyElVal = document.createElement('span')\n              keyElVal.innerHTML = resultMap[lowerKey].element.innerHTML\n\n            } else {\n              keyElVal = document.createElement('span')\n              keyElVal.innerHTML = tcval\n            }\n\n            keyElement.appendChild(keyElVal)\n          })\n        }\n      } else {\n        if (lowerKey == 'title') {\n          resultTitleLink.innerHTML = result.item.title\n          if (!result.item.title || result.item.title == '') {\n            resultTitleLink.innerHTML = 'Untitled'\n          }\n        } else if (lowerKey == 'content') {\n          if (result.item.content && (result.item.content != '')) {\n            keyElement = document.createElement('div')\n            keyElement.innerHTML = result.item.content\n          }\n        } else if (result.item[lowerKey]) {\n          keyElement = document.createElement('div')\n          keyElement.setAttribute('class', 'search-result-' + lowerKey)\n          keyElement.appendChild(document.createTextNode(key + ':  '))\n          firstVal = true\n          result.item[lowerKey].forEach(function (tcval, tckey) { // eslint-disable-line no-unused-vars\n            if (!firstVal) {\n              keyElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            var keyElVal = document.createElement('span')\n            keyElVal.innerHTML = tcval\n            keyElement.appendChild(keyElVal)\n          })\n        }\n      }\n\n      if (lowerKey == 'title') {\n        keyElement.appendChild(resultTitleLink)\n      }\n\n      if (typeof keyElement !== 'undefined') {\n        resultElement.appendChild(keyElement)\n      }\n    })\n\n    document.getElementById('search-results').appendChild(resultElement)\n  })\n\n  return true\n}\n\nexport {\n  doCloseSearch,\n  doSearch,\n  executeSearch,\n  createMark,\n  markMatches,\n  populateResults\n}\n"],"names":["fuseOptions","distance","findAllMatches","shouldSort","includeMatches","minMatchCharLength","threshold","tokenize","keys","name","weight","doCloseSearch","document","getElementById","style","innerHTML","doSearch","searchQuery","search_form","s","value","searchFuseOptions","length","executeSearch","para","createElement","innerText","appendChild","request","XMLHttpRequest","open","indexurl","onload","status","jsonprep","responseText","replace","pages","JSON","parse","result","Fuse","search","populateResults","console","log","onerror","send","createMark","markel","spanel","setAttribute","markMatches","matches","newResult","forEach","items","num","newElement","prevIndexEnd","indices","indexpair","indexnum","key","substring","matchString","newSubString","createTextNode","results","resnum","resultElement","id","toString","item","content","resultMap","keyElement","resultTitleLink","lowerKey","toLowerCase","permalink","element","innnerHTML","keyElVal","firstVal","tcval","tckey","original_value","title"],"mappings":"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"}