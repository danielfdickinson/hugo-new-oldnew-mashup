/*! Copyright 2007-2020 Daniel F. Dickinson
    <cshored@thecshore.com>
 *  Released under the Creative Commons BY (Attribution) 4.0 License
 */
// OldNewMashup Theme Page Header Styling

// ########################################################################

// Mixins - sub-'functions'

// ########################################################################

@mixin page-top-search-form($device-capabilities: 'normal-plus-screen', $sub-devcap: null) {

  & form {
    display: inline-block;
    height: 100%;
    text-align: right;

    @supports (display: flex) {
      display: flex;
      flex-wrap: nowrap;
      justify-content: flex-end;
      text-align: left;
    }

    width: 100%;

    @supports (border-radius: 12px) {
      & input {
        border-radius: 12px;
      }
    }

    & input {
      border: 2px solid $default-top-bar-border-color;
      height: 100%;

      &[type='search'] {
        display: inline-block;
        width: 66%;

        @supports (flex: 1 2 5em) {
          flex: 1 2 5em;
          width: auto;
        }
      }

      &[type='submit'] {
        display: inline-block;
        max-width: 3em;
        width: 33%;

        @supports (flex: 0 1 3em) {
          flex: 0 1 3em;
          max-width: none;
          width: auto;
        }
      }
    }
  } @if $device-capabilities == 'speech' {
    & form {
      display: none;
      visibility: hidden;
    }
  }
}

@mixin menubar-needs-overflow-submenu($device-capabilities: 'all-browsers', $menu-level: 2, $sub-devcap: null) {
  $submenu-pos-number: $menu-level;

  @if $menu-level <= $flyout-max-menu-level {
    $submenu-mod: ($menu-level % 2);

    @if $submenu-mod == 1 {
      $submenu-pos-number: $menu-level + 1;
    }
  }

  & > .menu-item {
    @include menubar-menu-list-position-submenus($device-capabilities, $submenu-pos-number);

    @if $device-capabilities == 'all-browsers' {
      height: $flyout-menu-item-height;
      width: $flyout-menu-item-width;

      & .menu-parent {
        height: auto;
        width: $flyout-menu-item-width;
      }
    } @elseif $device-capabilities == 'small-screen' or $device-capabilities == 'no-hover' {
      height: auto;
      width: 100%;

      & .menu-parent {
        width: 100%;
      }
    } @elseif $device-capabilities == 'normal-plus-screen' {
      height: $flyout-menu-item-height;
      overflow: visible;
      width: $flyout-menu-item-width;

      & .menu-parent {
        height: auto;
        overflow: visible;
        width: $flyout-menu-item-width;
      }
    }
  }
}

@mixin menubar-needs-columns-submenu($device-capabilities: 'all-browsers', $menu-level: 2, $sub-devcap: null) {

  height: auto;

  @if $device-capabilities == 'all-browsers' or $device-capabilities == 'normal-plus-screen' {
    left: 0;
    position: relative;
    width: $flyout-menu-item-width;

    & > .menu-item {
      @if $sub-devcap != 'ms-edge12+' and $sub-devcap != 'ie11+' {
        @include menubar-menu-list-position-submenus($device-capabilities, $menu-level + 1);
      } @else {
        & > ul {
          &.menu-parent {
            left: 0;
          }
        }
      }
    }
  } @elseif $device-capabilities == 'small-screen' or $device-capabilities == 'no-hover' {
    left: 0;
    position: static;
    width: 100%;

    & > .menu-item {
      @include menubar-menu-list-position-submenus($device-capabilities, $menu-level);
    }
  }
}

@mixin menubar-needs-columns($device-capabilities: 'all-browsers', $sub-devcap: null, $menu-level: 1) {
  @if $menu-level <= $flyout-max-menu-level {
    $submenu-pos-number: ($menu-level % 2);
    $left-pos: -100%;

    @if $submenu-pos-number == 1 {
      $left-pos: 100%;
    }

    top: auto;

    &.needs-columns {
      @if $device-capabilities == 'all-browsers' or $device-capabilities == 'normal-plus-screen' {
        height: $flyout-menu-column-height;
        left: $left-pos;
        overflow: auto;
        width: $flyout-menu-column-width + .1em;
      }

      @if $device-capabilities == 'small-screen' or $device-capabilities == 'no-hover' {
        height: auto;
        left: 0;
        overflow: hidden;
        width: 100%;

        & > .menu-item {
          height: auto;
          left: 0;
          overflow: hidden;
          width: 100%;
        }
      }

      &.needs-overflow {
        @include menubar-needs-overflow-submenu($device-capabilities, $menu-level, $sub-devcap);

        @if $device-capabilities == 'normal-plus-screen' {
          overflow-y: scroll;

          @if $sub-devcap == 'ie11+' {
            column-width: inherit;
          }
        }
      }

      &:not(.needs-overflow) {
        @include menubar-needs-overflow-submenu($device-capabilities, $menu-level, $sub-devcap);
        @include menubar-needs-columns-submenu($device-capabilities, $menu-level, $sub-devcap);

        @if $device-capabilities == 'normal-plus-screen' {
          height: $flyout-menu-column-height;
          left: $left-pos;
          overflow: auto;
          width: $flyout-menu-column-width + .1em;

          @supports (column-width: $flyout-menu-item-width) {
            column-fill: auto;
            column-gap: 0;
            column-width: $flyout-menu-item-width;
            overflow: visible;
          }

          @if $sub-devcap == 'ie11+' {
            &.menu-parent {
              column-fill: auto;
              column-gap: 0;
              column-width: $flyout-menu-item-width;
              height: $flyout-menu-column-height + .4em;
              overflow: visible;
            }
          }
        } @elseif $device-capabilities == 'no-hover' {
          column-width: inherit;
          height: auto;
          left: 0;
          overflow: hidden;
          width: 100%;
        }
      }
    }
  }
}

@mixin menubar-menu-link($device-capabilities: 'all-browsers') {

  & > .menu-link {
    @if $device-capabilities == 'all-browsers' {
      background-color: inherit;
      display: block;
      height: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      width: 100%;

      &:link,
      &:hover,
      &:active {
        display: block;
        text-decoration: none;
      }

      &:hover,
      &:active {
        background-color: $default-hover-background-color;
      }

      & .menu-entry {
        display: block;
        overflow: hidden;
        position: relative;
        text-overflow: ellipsis;
        top: 20%;
        white-space: nowrap;
      }
    } @elseif $device-capabilities == 'small-screen' {
      padding: .4em;
    } @elseif $device-capabilities == 'normal-plus-screen' {
      padding: .4em;
    }
  }
}

@mixin menubar-menu-entry-wrapper($device-capabilities: 'all-browsers') {

  & > .menu-entry-wrapper {

    @include menubar-menu-link($device-capabilities);

    @if $device-capabilities == 'all-browsers' {
      background-color: inherit;
      height: 100%;
      width: 100%;
    } @elseif $device-capabilities == 'small-screen' {
      border: 0 none;
      border-bottom: 2px solid $hamburger-top-bar-menu-border-color;
      height: $flyout-menu-item-height;
    } @elseif $device-capabilities == 'normal-plus-screen' {
      border: 0 none;
    } @elseif $device-capabilities == 'no-hover' {
      border-bottom: 2px solid $hamburger-top-bar-menu-border-color;
    }
  }
}

@mixin menubar-sub-submenu-inactive($device-capabilities: 'all-browsers', $menu-level: 1) {
  @if $menu-level <= $flyout-max-menu-level {
    visibility: hidden;

    & > .menu-item {
      visibility: hidden;

      & > .menu-parent {
        @include menubar-sub-submenu-inactive($device-capabilities, $menu-level + 1)

        visibility: hidden;
      }
    }
  }
}

@mixin menubar-site-menu-list-active($device-capabilities: 'all-browsers', $menu-level: 0, $is-visible: false) {

  @if $menu-level <= $flyout-max-menu-level {

    $maybe-hidden: hidden;

    @if $is-visible == true {
      $maybe-hidden: visible;
    }

    @if $is-visible {
      visibility: $maybe-hidden;

      & > .menu-item {
        visibility: $maybe-hidden;
      }
    }

    @if $is-visible == false {
      @include menubar-sub-submenu-inactive($device-capabilities, $menu-level);
    } @elseif $is-visible == true {
      & > .menu-item {
        & > .menu-parent {
          @if ($device-capabilities == 'small-screen') or ($device-capabilities == 'no-hover') {
            @include menubar-site-menu-list-active($device-capabilities, $menu-level + 1, true);
          } @else {
            @include menubar-sub-submenu-inactive($device-capabilities, $menu-level);
          }
        }
      }
    }

    & > .menu-item {
      &:hover {
        & > .menu-parent {
          @include menubar-site-menu-list-active($device-capabilities, $menu-level + 1, true);
        }
      }
    }
  }
}

@mixin menubar-menu-list-position($device-capabilities: 'all-browsers', $menu-level: 0) {
  $left-pos: -100%;

  @if $device-capabilities == 'all-browsers' or $device-capabilities == 'normal-plus-screen' {
    $submenu-pos-number: ($menu-level % 2);
    @if $submenu-pos-number == 1 {
      $left-pos: 100%;
    }

    left: $left-pos;
    z-index: $flyout-z-index + $menu-level;

    & > .menu-item {
      & > .menu-entry-wrapper {
        padding-left: inherit;
      }
    }
  } @elseif $device-capabilities == 'small-screen' or $device-capabilities == 'no-hover' {
    & > .menu-item {
      & > .menu-entry-wrapper {
        padding-left: #{$menu-level}em;
      }
    }
  }
}

@mixin menubar-menu-list-position-submenus($device-capabilities: 'all-browsers', $menu-level: 0) {
  @if $menu-level <= $flyout-max-menu-level {
    & > .menu-parent {
      @include menubar-menu-list-position($device-capabilities, $menu-level + 1)

      & > .menu-item {
        @include menubar-menu-list-position-submenus($device-capabilities, $menu-level + 1);
      }
    }
  }
}

@mixin menubar-menu-list-color($device-capabilities: 'all-browsers', $menu-level: 0) {
  $submenu-background-color: $flyout-submenu-colors-0;

  @if $device-capabilities == 'all-browsers' or $device-capabilities == 'normal-plus-screen' {
    $submenu-color-number: ($menu-level % 3);
    @if $submenu-color-number == 0 {
      $submenu-background-color: $flyout-submenu-colors-0;
    } @elseif $submenu-color-number == 1 {
      $submenu-background-color: $flyout-submenu-colors-1;
    } @else {
      $submenu-background-color: $flyout-submenu-colors-2;
    }

    background-color: $submenu-background-color;
  } @else {
    background-color: $submenu-background-color;
  }
}

@mixin menubar-menu-list-color-submenus($device-capabilities: 'all-browsers', $menu-level: 0) {
  @if $menu-level <= $flyout-max-menu-level {
    & > .menu-parent {
      @include menubar-menu-list-color($device-capabilities, $menu-level + 1)

      & > .menu-item {
        @include menubar-menu-list-color-submenus($device-capabilities, $menu-level + 1);
      }
    }
  }
}

@mixin menubar-site-menu-list($device-capabilities: 'all-browsers', $sub-devcap: null) {

  @include menubar-menu-list-color($device-capabilities, 0);

  & .menu-item {
    @include menubar-menu-entry-wrapper($device-capabilities);

    background-color: inherit;
    margin: 0;
    padding: 0;

    & .menu-parent {

      @include menubar-needs-columns($device-capabilities, $sub-devcap, 1);

      display: block;
      list-style-position: outside;
      list-style-type: none;
      margin: 0;
      padding: 0;

      @if (($device-capabilities == 'small-screen') or ($device-capabilities == 'no-hover')) {
        border: 0 none;
        margin-top: 0;
        position: static;
      } @elseif $device-capabilities == 'all-browsers' or $device-capabilities == 'normal-plus-screen' {
        border: 2px solid $hamburger-top-bar-menu-border-color;
        margin-top: -4ex;
        position: relative;
      }
    }
  }

  & > .menu-item {
    @include menubar-menu-list-color-submenus($device-capabilities, 0);
    @include menubar-menu-list-position-submenus($device-capabilities, 0);
  }

  @if $device-capabilities == 'all-browsers' {
    border: 2px solid $hamburger-top-bar-menu-border-color;
    border-top: 0 none;
    display: block;
    left: .5%;
    list-style-position: outside;
    list-style-type: none;
    margin: 0;
    padding: 0;
    position: fixed;
    top: 5.5%;
    width: $flyout-menu-item-width;

    & .menu-item {
      display: block;
      height: $flyout-menu-item-height - .1em;
      margin: 0;
      overflow: visible;
      padding: 0;
      width: $flyout-menu-item-width - .3em;
      z-index: $flyout-z-index;

      & .menu-parent {
        margin: 0;
        margin-top: -4ex;
      }

      & a {
        &:link {
          color: $hamburger-top-bar-menu-link-color;
        }
      }
    }

  } @elseif $device-capabilities == 'small-screen' {
    height: 100%;
    left: 0;
    margin: 0;
    position: absolute;
    top: $hamburger-top-bar-width;
    width: 100%;

    & .menu-item {
      height: auto;
      width: 100%;

      & .menu-parent {
        width: 100%;
      }
    }
  } @elseif $device-capabilities == 'normal-plus-screen' {
    height: auto;
    left: $hamburger-top-bar-width;
    margin: 0;
    position: fixed;
    top: $hamburger-top-bar-height;
    width: $flyout-menu-item-width;

    & .menu-item {
      height: $flyout-menu-item-height;
      width: 100%;

      & .menu-parent {
        width: $flyout-menu-item-width;
      }
    }
  } @elseif $device-capabilities == 'no-hover' {
    height: 100%;
    left: 0;
    margin: 0;
    position: relative;
    top: $hamburger-top-bar-width;
    width: 100%;

    & .menu-item {
      height: auto;
      width: 100%;

      & .menu-parent {
        width: 100%;
      }
    }
  }
}

@mixin menubar-activate-site-menu-list($device-capabilities, $activate-menu, $is-first: true) {

  $maybe-visible: hidden;

  @if $activate-menu == true {
    $maybe-visible: visible;
  }

  @if $activate-menu == true {
    @include menubar-site-menu-list-active($device-capabilities, 0, true);
  } @else {
    @include menubar-site-menu-list-active($device-capabilities, 0, false);
  }

  @if ($device-capabilities == 'small-screen') or ($device-capabilities == 'no-hover') {
    visibility: $maybe-visible;

    & .menu-item {
      visibility: $maybe-visible;

      & .menu-parent {
        visibility: $maybe-visible;
      }
    }
  } @elseif ($device-capabilities == 'all-browsers') or ($device-capabilities == 'normal-plus-screen') {
    visibility: $maybe-visible;

    & > .menu-item {
      visibility: $maybe-visible;

      & .menu-parent {
        visibility: hidden;

        & .menu-item {
          visibility: hidden;
        }
      }
    }
  } @elseif ($device-capabilities == 'speech') {
    & .menu-item {
      visibility: visible;

      & .menu-parent {
        visibility: visible;
      }
    }
  }

  @if $is-first {
    &:hover {
      @include menubar-activate-site-menu-list($device-capabilities, true, false);
    }
  }
}

@mixin menubar-site-menu-active($device-capabilities, $maybe-activate-menu) {

  $standalone-specificity: '.menubar-site-menu-list.menubar-site-menu-list.menubar-site-menu-list.menubar-site-menu-list.menubar-site-menu-list.menubar-site-menu-list';

  @if $device-capabilities != 'small-screen' and $device-capabilities != 'no-hover' {
    // Making standalone hover ul makes no sense when there is no hover
    @at-root ul {
      &#{$standalone-specificity} {
        @include menubar-activate-site-menu-list($device-capabilities, false, true);
      }
    }
  }

  & > ul {
    &.menubar-site-menu-list {
      @include menubar-activate-site-menu-list($device-capabilities, $maybe-activate-menu, true);
    }
  }
}

@mixin menubar-site-menu($device-capabilities: 'small-screen', $sub-devcap: null) {

  @if $device-capabilities == 'all-browsers' {
    & .menubar-site-menu-list {
      @include menubar-site-menu-list($device-capabilities, $sub-devcap);
    }
  } @else {
    & .menubar-site-menu {
      & .menubar-site-menu-list {
        @include menubar-site-menu-list($device-capabilities, $sub-devcap);
      }
    }
  }

  & .menubar-site-menu {
    @if $device-capabilities == 'all-browsers' {
      // For the case where nav tag is not understood
      display: block;  // So children can be visible
      height: 0;
      overflow: visible;  // So children can be visible
      visibility: hidden;
      width: 0;
      z-index: 0;
    } @elseif $device-capabilities == 'small-screen' {
      left: 0;
      top: 0;
      width: 100%;

      & .menubar-site-menu-list {
        border: 2px solid $hamburger-top-bar-menu-border-color;
        border-top: 0;
      }
    } @elseif $device-capabilities == 'normal-plus-screen' {
      left: $hamburger-top-bar-width;
      top: $hamburger-top-bar-height;
      width: $flyout-menu-item-width;

      & .menubar-site-menu-list {
        @include menubar-site-menu-list($device-capabilities);
      }

    } @elseif $device-capabilities == 'no-hover' {
      left: 0;
      top: 0;
      width: 100%;

      & .menubar-site-menu-list {
        border: 2px solid $hamburger-top-bar-menu-border-color;
        border-top: 0;
      }
    }
  }
}

@mixin top-bar-trigger-checked-header($device-capabilities: 'small-screen', $sub-devcap: null) {

  & ~ .top-bar {

    @if $device-capabilities == 'small-screen' or $device-capabilities == 'no-hover' {
      position: fixed;
      visibility: visible;
    }

    & .top-bar-start {
      background-color: $hamburger-start-hover-background-color;
    }

    & .site-badge {
      @if $device-capabilities == 'normal-plus-screen' {
        left: $hamburger-top-bar-width;
        position: fixed;
        top: 0;
      } @elseif $device-capabilities == 'no-hover' {
        left: 0;
        position: absolute;
        top: 0;
      }
      visibility: visible;
    }

    & .menubar-site-menu {
      @if $device-capabilities == 'small-screen' or $device-capabilities == 'no-hover' {
        @include menubar-site-menu-active($device-capabilities, true);
      } @else {
        @include menubar-site-menu-active($device-capabilities, false);
      }
    }

    & .top-search {
      @if $sub-devcap != 'ie9+' and $sub-devcap != 'ie11+' and $device-capabilities != 'speech' {
        @if $device-capabilities == 'normal-plus-screen' {
          position: fixed;
          right: 0;
          top: 0;
        }
        visibility: visible;
      }
      @if $sub-devcap == 'ms-edge12+' {
        @if $device-capabilities == 'normal-plus-screen' {
          position: fixed;
          right: 0;
          top: 0;
        }
        visibility: visible;
      }
      @if $device-capabilities == 'no-hover' {
        position: absolute;
        right: auto;
        top: $hamburger-top-bar-height;
      }
    }
  }
}

@mixin top-bar-trigger-checked($device-capabilities: 'small-screen', $sub-devcap: null) {

  @include top-bar-trigger-checked-header($device-capabilities, $sub-devcap);

  & ~ .top-bar-overlay {
    @if $device-capabilities == 'small-screen' {
      visibility: visible;
    } @elseif $device-capabilities == 'no-hover' {
      visibility: visible;
    }
  }
}

@mixin site-badge-hover($device-capabilities: 'all-browsers') {

  $standalone-specificity: '.menubar-site-menu-list.menubar-site-menu-list.menubar-site-menu-list.menubar-site-menu-list.menubar-site-menu-list.menubar-site-menu-list';

  &:hover {
    border: 2px inset $default-top-bar-hover-border-color;
    visibility: visible;

    @if $device-capabilities == 'all-browsers' {
      & ~ ul {
        &#{$standalone-specificity} {
          @include menubar-activate-site-menu-list($device-capabilities, true, true);
        }
      }

      @at-root ul {
        &#{$standalone-specificity} {
          @include menubar-activate-site-menu-list($device-capabilities, false, true);
        }
      }
    } @elseif $device-capabilities == 'normal-plus-screen' {
      $specificity: '.menubar-site-menu.menubar-site-menu.menubar-site-menu';

      & + nav {
        &#{$specificity} {
          @include menubar-site-menu-active($device-capabilities, true);
        }
      }
    }
  }
}

@mixin curved-site-badge($device-capabilities: 'all-browsers', $sub-devcap: null) {
  @supports (border-radius: 12px) {
    border-radius: 12px;

    &:hover,
    &:active,
    &:link {
      border-radius: 12px;
    }

    & > .graphics-row {
      border-radius: 0; // sass-lint:disable-line property-sort-order
      border-bottom-left-radius: 12px; // sass-lint:disable-line property-sort-order
      border-top-left-radius: 12px;
    }
  }

  @if $sub-devcap == 'ie9+' {
    border-radius: 12px;

    &:hover,
    &:active,
    &:link {
      border-radius: 12px;
    }

    & > .graphics-row {
      border-radius: 0; // sass-lint:disable-line property-sort-order
      border-bottom-left-radius: 12px; // sass-lint:disable-line property-sort-order
      border-top-left-radius: 12px;
    }
  }
}

@mixin mobile-site-badge($device-capabilities: 'small-screen', $sub-devcap: null) {
  & .site-badge {

    @include curved-site-badge($device-capabilities, $sub-devcap);

    left: 0;
    margin: 0;
    position: absolute;
    text-align: left;
    visibility: hidden;

    @if $device-capabilities == 'no-hover' {
      & > .graphics-row {
        float: none;
      }
    }

    @supports (display: flex) {
      align-items: center;
      display: flex;
      justify-content: stretch;
      position: relative;

      & .graphics-row {
        align-content: center;
        align-items: stretch;
        display: inline-flex;
        flex: 0 1 $hamburger-top-bar-width;
        justify-content: stretch;
        text-align: left;
      }

      & .site-badge-graphic {
        align-self: center;
        flex: 0 1 $site-badge-graphic-width;
      }

      & .site-id {
        align-self: center;
        flex: 0 1 $site-id-width;
        height: auto;
        text-align: left;

        & span {
          display: inline;
          vertical-align: baseline;
        }
      }
    }
  }
}

@mixin site-badge($device-capabilities: 'all-browsers', $sub-devcap: null) {
  @if $device-capabilities == 'all-browsers' {
    & .site-badge {
      @include site-badge-hover($device-capabilities);

      background-color: $default-top-bar-background-color;
      border: 2px solid $default-top-bar-border-color;
      color: $default-link-color;
      display: block;
      height: $hamburger-top-bar-height;
      left: 0;
      margin: 0;
      margin-left: .5%;
      margin-top: .5%;
      max-width: $site-badge-width;
      overflow: hidden;
      padding: 0;
      position: fixed;
      text-align: center;
      top: 0;
      visibility: visible;
      z-index: $hamburger-top-bar-z-index;

      & .graphics-row {
        background-color: $site-badge-graphic-background-color;

        display: block;
        float: left;
        height: 100%;
        max-width: $site-badge-graphic-width;
      }

      & .site-id {
        display: block;
        font-family: $serif-font-stack;
        height: 100%;
        margin-left: .2em;
        overflow: hidden;
        text-align: left;
        width: $site-id-width;
        @supports (text-overflow: ellipsis) {
          text-overflow: ellipsis;
        }

        & span {
          display: block;
          left: .2em;
          position: relative;
          top: 20%;

          @supports (white-space: nowrap) {
            white-space: nowrap;
          }
        }
      }

      &:link,
      &:hover,
      &:active {
        text-decoration: none;
      }

      &:hover {
        .graphics-row {
          background-color: $default-background-color;
        }
      }

      & .site-badge-graphic {
        height: 100%;
        overflow: hidden;
        padding: 0;
        text-align: center;
        width: auto;
      }
    }
  } @elseif $device-capabilities == 'small-screen' {
    @include mobile-site-badge($device-capabilities, $sub-devcap);
  } @elseif $device-capabilities == 'normal-plus-screen' {
    & .site-badge {
      @include curved-site-badge($device-capabilities, $sub-devcap);

      left: $hamburger-top-bar-width;
      margin: 0;
      position: absolute;
      top: 0;
      visibility: visible;

      & .site-id {
        & span {
          display: inline;
        }
      }

      @supports (display: flex) {
        align-items: center;
        display: flex;
        justify-content: stretch;
        text-align: left;
      }
    }

    & a {
      &.site-badge {
        @include site-badge-hover($device-capabilities);
      }
    }
  } @elseif $device-capabilities == 'no-hover' {
    @include mobile-site-badge($device-capabilities, $sub-devcap);
  } @elseif $device-capabilities == 'speech' {
    & .site-badge {
      visibility: visible;

      & .graphics-row {
        display: none;
        visibility: hidden;
      }

      & .site-badge-graphic {
        display: none;
        visibility: hidden;
      }

      & .site-id {
        visibility: visible;
      }
    }
  }
}

@mixin desktop-overlay($device-capabilities: 'all-browsers', $sub-devcap: null) {
  background-color: $default-background-color;
  height: $hamburger-top-bar-height + 1em;
  visibility: visible;
  z-index: 0;

  @supports (background-color: transparent) {
    background-color: transparent;
  }

  @supports (opacity: 0) {
    opacity: 0;
  }

  @if $sub-devcap == 'ie9+' {
    background-color: transparent;
    opacity: 0;
  }
}

@mixin mobile-overlay($device-capabilities: 'small-screen', $sub-devcap: null) {
  background-color: $top-bar-off-canvas-overlay-color;
  height: 100%;
  position: fixed;
  visibility: hidden;
  z-index: $top-bar-off-canvas-overlay-z-index;

  @supports (opacity: $top-bar-off-canvas-overlay-opacity) {
    opacity: $top-bar-off-canvas-overlay-opacity;
  }

  @if $sub-devcap == 'ie9+' {
    opacity: $top-bar-off-canvas-overlay-opacity;
  }
}

@mixin top-bar-overlay($device-capabilities: 'all-browsers', $sub-devcap: null) {

  & .top-bar-overlay {
    @if $device-capabilities == 'all-browsers' {
      @include desktop-overlay($device-capabilities, $sub-devcap);

      visibility: visible;
      width: 100%;
    } @elseif $device-capabilities == 'small-screen' {
      @include mobile-overlay($device-capabilities, $sub-devcap);

      left: 0;
      top: 0;
    } @elseif $device-capabilities == 'normal-plus-screen' {
      display: none;
      left: 0;
      position: relative;
      top: 0;
      visibility: hidden;
    } @elseif $device-capabilities == 'no-hover' {
      @include mobile-overlay($device-capabilities, $sub-devcap);
      display: block;
    } @elseif $device-capabilities == 'speech' or $device-capabilities == 'print' {
      display: none;
      visibility: hidden;
    }
  }
}

@mixin default-top-bar-trigger($device-capabilities: 'small-screen', $sub-devcap: null) {
  @supports (background-color: transparent) {
    background-color: transparent;
  }
  @if $sub-devcap == 'ie9+' {
    background-color: transparent;
  }
  cursor: pointer;
  display: block;
  height: $hamburger-top-bar-height;
  @supports (opacity: 0) {
    opacity: 0;
  }
  @if $sub-devcap == 'ie9+' {
    opacity: 0;
  }
  position: fixed;
  top: 0;
  visibility: visible;
  width: $hamburger-top-bar-width;
  z-index: $hamburger-top-bar-z-index + 2;

  @if $device-capabilities == 'small-screen' or $device-capabilities == 'no-hover' {
    left: auto;
    right: 0;
  } @elseif $device-capabilities == 'normal-plus-screen' {
    left: 0;
    right: auto;
  }
}

@mixin top-bar-trigger($device-capabilities: 'all-browsers', $sub-devcap: null) {
  & .top-bar-trigger {
    &:checked,
    &:hover {
      @include top-bar-trigger-checked($device-capabilities, $sub-devcap);
    }

    @if $device-capabilities == 'all-browsers' {
      display: none;
      height: 0;
      visibility: hidden;
      width: 0;
      z-index: 0;
    } @elseif $device-capabilities == 'small-screen' {
      @include default-top-bar-trigger($device-capabilities, $sub-devcap);
    } @elseif $device-capabilities == 'normal-plus-screen' {
      @include default-top-bar-trigger($device-capabilities, $sub-devcap);
    } @elseif $device-capabilities == 'no-hover' {
      @include default-top-bar-trigger($device-capabilities, $sub-devcap);
    } @elseif $device-capabilities == 'speech' {
      display: none;
      visibility: hidden;
    }
  }
}

@mixin default-top-bar-start($device-capabilities: 'small-screen', $sub-devcap: null, $left: auto, $right: 0) {
  background-color: $hamburger-start-background-color;
  display: block;
  height: $hamburger-top-bar-height;
  left: $left;
  @supports (opacity: .5) {
    opacity: .5;
  }
  padding: 0;
  position: fixed;
  right: $right;
  text-align: center;
  visibility: visible;
  width: $hamburger-top-bar-width;
  z-index: $hamburger-top-bar-z-index + 1;

  @supports (border-radius: 12px) {
    border-radius: 12px;
  }

  @if $sub-devcap == 'ie9+' {
    border-radius: 12px;
    opacity: .5;
  }

  & a {
    z-index: $hamburger-top-bar-z-index;

    &:link {
      background-color: $hamburger-start-background-color;
      display: block;
      height: $hamburger-top-bar-height;
      left: $left;
      @supports (opacity: .5) {
        opacity: .5;
      }
      padding: 0;
      position: fixed;
      right: $right;
      text-align: center;
      visibility: visible;
      width: $hamburger-top-bar-width;
      @supports (border-radius: 12px) {
        border-radius: 12px;
      }

      @if $sub-devcap == 'ie9+' {
        border-radius: 12px;
        opacity: .5;
      }
    }

    &:hover,
    &:active {
      background-color: $hamburger-start-hover-background-color;
      @supports (opacity: .5) {
        opacity: .5;
      }
      @supports (border-radius: 12px) {
        border-radius: 12px;
      }
      @if $sub-devcap == 'ie9+' {
        border-radius: 12px;
        opacity: .5;
      }
    }
  }
}

@mixin top-bar-start($device-capabilities: 'all-browsers', $sub-devcap: null) {
  & .top-bar-start {
    @if $device-capabilities == 'all-browsers' {
      display: none;
      visibility: hidden;
    } @elseif $device-capabilities == 'small-screen' {
      @include default-top-bar-start($device-capabilities, $sub-devcap);
    } @elseif $device-capabilities == 'normal-plus-screen' {
      @include default-top-bar-start($device-capabilities, $sub-devcap, 0, auto);
    } @elseif $device-capabilities == 'no-hover' {
      @include default-top-bar-start($device-capabilities, $sub-devcap);
    } @elseif $device-capabilities == 'speech' {
      display: none;
      visibility: hidden;
    }
  }
}

@mixin top-bar-search-results($device-capabilities: 'all-browsers', $sub-devcap: null) {
  & .search-results {
    @if $device-capabilities == 'all-browsers' {
      display: none;
      visibility: hidden;
    } @elseif $device-capabilities == 'normal-plus-screen' {
      background-color: $search-results-background-color;
      bottom: 0;
      color: $search-results-text-color;
      display: block;
      @if $sub-devcap == 'ie9+' {
        display: none;
      } @elseif $sub-devcap == 'ms-edge12+' {
        display: block;
      }

      max-height: 80%;
      overflow-x: hidden;
      overflow-y: scroll;
      position: fixed;
      right: 0;
      width: 100%;
      z-index: $flyout-z-index + 1;

      & a {
        background-color: $search-results-background-color;
        color: $search-results-link-color;

        &:link {
          color: $search-results-link-color;
        }

        &:visited {
          color: $search-results-visited-color;
        }

        &:active,
        &:hover {
          color: $search-results-hover-color;
        }
      }
    } @elseif $device-capabilities == 'no-hover' {
      background-color: $search-results-background-color;
      bottom: 0;
      color: $search-results-text-color;
      display: block;
      max-height: 80%;
      overflow-x: hidden;
      overflow-y: scroll;
      position: fixed;
      right: 0;
      width: 100%;
      z-index: $flyout-z-index + 1;

      & a {
        background-color: $search-results-background-color;
        color: $search-results-link-color;

        &:link {
          color: $search-results-link-color;
        }

        &:visited {
          color: $search-results-visited-color;
        }

        &:active,
        &:hover {
          color: $search-results-hover-color;
        }
      }
    } @elseif $device-capabilities == 'speech' {
      display: none;
    }
  }
}

@mixin top-bar-search($device-capabilities: 'all-browsers', $sub-devcap: null) {
  & .top-search {
    @if $device-capabilities == 'all-browsers' {
      display: none;
      visibility: hidden;
    } @elseif $device-capabilities == 'normal-plus-screen' {
      @if ($sub-devcap != 'ie9+' and $sub-devcap != 'ie11+') or $sub-devcap == 'ms-edge12+' {
        @include page-top-search-form($device-capabilities, $sub-devcap);

        display: block;
        float: right;
        height: $hamburger-top-bar-height;
        visibility: visible;
        width: 60%;
      }
   } @elseif $device-capabilities == 'no-hover' {
      @if ($sub-devcap != 'ie9+' and $sub-devcap != 'ie11+') or $sub-devcap == 'ms-edge12+' {
        @include page-top-search-form($device-capabilities, $sub-devcap);

        display: block;
        float: none;
        height: $hamburger-top-bar-height;
        left: 0;
        margin: 0;
        position: absolute;
        right: auto;
        top: $hamburger-top-bar-height;
        visibility: hidden;
        width: 100%;
        z-index: $hamburger-top-bar-z-index;
        @supports (display: flex) {
          display: flex;
          justify-content: stretch;
        }
      }
    } @elseif $device-capabilities == 'speech' {
      @include page-top-search-form($device-capabilities, $sub-devcap);

      display: none;
      visibility: hidden;
    }
  }
}

@mixin top-bar-contents($device-capabilities: 'all-browsers', $sub-devcap: null) {
  @include site-badge($device-capabilities, $sub-devcap);
  @include top-bar-start($device-capabilities, $sub-devcap);
  @include menubar-site-menu($device-capabilities, $sub-devcap);
  @include top-bar-search($device-capabilities, $sub-devcap);
  @include top-bar-search-results($device-capabilities, $sub-devcap);
}

@mixin top-bar-off-canvas($device-capabilities: 'small-screen') {
  background-color: $default-top-bar-background-color;

  @supports (background-color: transparent) {
    background-color: transparent;
  }

  color: $hamburger-top-bar-menu-text-color;
  height: $top-bar-off-canvas-height;
  left: 0;
  margin: 0;
  overflow: auto;
  overflow-y: scroll;
  padding: 0;
  position: fixed;
  top: 0;
  visibility: hidden;
  width: $top-bar-off-canvas-width;
  z-index: $hamburger-top-bar-z-index;
}

@mixin top-bar($device-capabilities: 'all-browsers', $sub-devcap: null) {
  @if $device-capabilities == 'all-browsers' {

    @include top-bar-contents($device-capabilities, $sub-devcap);

    & .top-bar {
      display: block; // So children can be visible
      height: 0;
      overflow: visible; // So children can be visible
      visibility: hidden;
      width: 0;
      z-index: 0;
    }
  } @else {
    & .top-bar {
      @if $device-capabilities == 'small-screen' {
        @include top-bar-off-canvas($device-capabilities);
        @include top-bar-contents($device-capabilities, $sub-devcap);
      } @elseif $device-capabilities == 'normal-plus-screen' {
        @include top-bar-contents($device-capabilities, $sub-devcap);

        height: $hamburger-top-bar-height;
        overflow: visible;
        position: relative;
        visibility: visible;
        width: 100%;
        z-index: $flyout-z-index;
      } @elseif $device-capabilities == 'no-hover' {
        @include top-bar-off-canvas($device-capabilities);
        @include top-bar-contents($device-capabilities, $sub-devcap);
      } @elseif $device-capabilities == 'speech' {
        @include site-badge($device-capabilities);
        @include menubar-site-menu($device-capabilities, $sub-devcap);
        @include menubar-site-menu-active($device-capabilities, true);

        visibility: visible;

        & .top-search {
          display: none;
          visibility: hidden;
        }

        & .search-results {
          display: none;
          visibility: hidden;
        }
      } @elseif $device-capabilities == 'print' {
        @include site-badge($device-capabilities);

        visibility: visible;

        & .menubar-site-menu {
          display: none;
          visibility: hidden;
        }

        & .top-search {
          display: none;
          visibility: hidden;
        }

        & .search-results {
          display: none;
          visibility: hidden;
        }
      }
    }
  }
}

@mixin header-wrapper-mq($device-capabilities: 'small-screen', $sub-devcap: null) {
  display: block;
  height: auto;
  visibility: visible;
  width: 100%;

  @if $sub-devcap == 'ie11+' {
    display: flex;
    flex: 1 1 100%;
    grid-column: initial;
    grid-row: initial;
    order: 1;
    width: auto;
  }

  @supports (not (display: grid)) and (display: flex) {
    display: flex;
    flex: 1 1 100%;
    order: 1;
    width: auto;
  }

  @supports (display: grid) {
    grid-column-end: 3;
    grid-column-start: 1;
    grid-row-end: 2;
    grid-row-start: 1;
    position: relative;
    width: auto;
  }
}

@mixin page-header($device-capabilities: 'all-browsers', $sub-devcap: null) {

  .header-wrapper {
    @include top-bar-trigger($device-capabilities, $sub-devcap);
    @include top-bar($device-capabilities, $sub-devcap);
    @include top-bar-overlay($device-capabilities, $sub-devcap);

    @if $device-capabilities == 'all-browsers' {
      left: 0;
      overflow: visible;
      position: relative;
      top: 0;
      visibility: hidden;
      width: 100%;
      z-index: $hamburger-top-bar-z-index;
    } @elseif $device-capabilities == 'small-screen' {
      @include header-wrapper-mq($device-capabilities, $sub-devcap);
    } @elseif $device-capabilities == 'normal-plus-screen' {
      @include header-wrapper-mq($device-capabilities, $sub-devcap);
    } @elseif $device-capabilities == 'no-hover' {
      @include header-wrapper-mq($device-capabilities, $sub-devcap);
    } @elseif $device-capabilities == 'speech' {
      @supports (order: 4) {
        flex: 1 1 100%;
        height: auto;
        order: 4;
        visibility: visible;
        width: auto;
      }
    } @elseif $device-capabilities == 'print' {
      display: none;
      visibility: hidden;
    }
  }
}
