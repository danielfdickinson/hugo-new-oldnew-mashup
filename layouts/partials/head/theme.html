{{/* Copyright 2018 Daniel F. Dickinson, Released under the Creative
  Commons 4.0 BY (Attribution) License */}}
{{- block "metarender" . -}}
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
{{- end -}}
{{ block "metadata" . }}
  {{ if (index .Params "categories") }}<meta name="keywords" content="{{ delimit (index .Params "categories") ", " }}">{{ end }}
  {{ if (index .Params "description") }}<meta name="description" content="{{ index .Params "description" }}">{{ end }}
  {{ if (index .Params "author") }}<meta name="author" content="{{ index .Params "author" }}">{{ end }}
  {{ hugo.Generator }}
{{- end -}}
{{ block "links" . }}
  {{ if ne (.Param "nobaseurl") true }}{{ if $.Site.BaseURL }}<base href="{{ $.Site.BaseURL }}">{{ end }}{{ end }}
  {{- $nb := resources.Get "css/new-base.scss" -}}
  {{- $nm := resources.Get "css/normalize.scss" -}}
  {{- $ds := resources.Get "css/define-scheme-vars.scss" -}}
  {{- if not (and $nb $nm $ds ) -}}
    {{- errorf "Missing static SCSS resources" -}}
  {{- end -}}
  {{- $ctx := . -}}
  {{- $activescheme := default "grey" (.Param "style_scheme") -}}
  {{- range $schemename := (slice "grey" "deepblue" "user" ) -}}
    {{- $stylesheetname := printf "css/%s-oldnew-mashup.css" $schemename }}
    {{- $options := (dict "enableSourceMap" true "compress" true "targetPath" $stylesheetname "includePaths" (slice "assets/scss/oldnew" )) -}}
    {{- $gsvresname := printf "css/scheme-%s.scss" $schemename -}}
    {{- $gsv := resources.Get $gsvresname -}}
    {{- if not $gsv -}}
      {{- errorf "Missing SCSS style scheme resources" -}}
    {{- end -}}
    {{- $nbtpl := $gsv -}}
    {{- $pregenstylesheetname := printf "css/oldnew-mashup/%s-oldnew-mashup.css" $schemename }}
    {{- $nbstyle := resources.Get $pregenstylesheetname -}}
    {{- if and ( eq (string hugo.Environment) "for-basic" ) ( not $.Site.IsServer ) -}}
      {{- if (eq $schemename "user") -}}
        {{- $nbtplname := printf "css/hugo-%s-scheme.scss" $schemename -}}
        {{- $nbtpl = $gsv | resources.ExecuteAsTemplate $nbtplname $ctx -}}
      {{- end }}
      {{- $nbnmcatname := printf "css/%s-oldnew-mashup.scss" $schemename -}}
      {{- $nbnmcat := slice $nm $ds $nbtpl $nb | resources.Concat $nbnmcatname -}}
        {{- $nbstyle = $nbnmcat | resources.ToCSS $options -}}
    {{- else if ( eq (string hugo.Environment) "extended" ) -}}
      {{- if (eq $schemename "user") -}}
        {{- $nbtplname := printf "css/hugo-%s-scheme.scss" $schemename -}}
        {{- $nbtpl = $gsv | resources.ExecuteAsTemplate $nbtplname $ctx -}}
      {{- end }}
      {{- $nbnmcatname := printf "css/%s-oldnew-mashup.scss" $schemename -}}
      {{- $nbnmcat := slice $nm $ds $nbtpl $nb | resources.Concat $nbnmcatname -}}
      {{- $nbstyle = $nbnmcat | resources.ToCSS $options | resources.Fingerprint -}}
    {{- else -}}
      {{- if (ne $schemename "user") -}}
        {{- if not $nbstyle -}}
          {{- errorf ( printf "Missing stylesheet '%s'" $stylesheetname ) -}}
        {{- end -}}
        {{- $nbstyle = $nbstyle | resources.Fingerprint -}}
      {{- end -}}
    {{- end -}}
    {{ if $nbstyle }}
  <link rel="{{ if (ne $schemename $activescheme) }}alternate {{ end }}stylesheet" href="{{ $nbstyle.Permalink }}" title="{{ $schemename | humanize }} Style" />
    {{- end }}
  {{- end -}}
{{- end }}
{{ block "output-formats" . }}
  {{ range .AlternativeOutputFormats }}
    {{- printf `<link rel="%s" type="%s" href="%s" title="%s %s" />` .Rel .MediaType.Type .Permalink $.Site.Title (upper .MediaType.SubType) | safeHTML }}
  {{ end -}}
{{- end -}}
{{- block "scripts" . -}}
  {{- $fusejs := resources.Get "js/krisk-Fuse.js" | resources.Fingerprint -}}
  {{- $jmarkjs := resources.Get "js/julmot-mark.js" | resources.Minify | resources.Fingerprint -}}
  {{- $search := resources.Get "js/search.js" | resources.Minify | resources.Fingerprint -}}
  {{- $confirmation := resources.Get "js/confirmation.js" | resources.Minify | resources.Fingerprint }}
  <script src="{{ $fusejs.RelPermalink }}"></script>
  <script src="{{ $jmarkjs.RelPermalink }}"></script>
  <script>
    var indexurl = {{ "index.json" | absURL }}
  </script>
  <script src="{{ $search.RelPermalink }}"></script>
  <script src="{{ $confirmation.RelPermalink }}"></script>
{{- end }}
