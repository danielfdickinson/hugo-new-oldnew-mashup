{{ block "metarender" . }}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <!-- Copyright 2018 Daniel F. Dickinson,
       Released under the Creative Commons 4.0 BY (Attribution) License -->
{{ end }}
{{ block "metadata" . }}
  {{ if (index .Params "categories") }}<meta name="keywords" content="{{ delimit (index .Params "categories") ", " }}">{{ end }}
  {{ if (index .Params "description") }}<meta name="description" content="{{ index .Params "description" }}">{{ end }}
  {{ if (index .Params "author") }}<meta name="author" content="{{ index .Params "author" }}">{{ end }}
{{ end }}
{{ block "links" . }}
  {{ if ne (.Param "nobaseurl") true }}{{ if $.Site.BaseURL }}<base href="{{ $.Site.BaseURL }}">{{ end }}{{ end }}
  {{- $nb := resources.Get "css/new-base.scss" -}}
  {{- if not $nb -}}
    {{- errorf "Missing static SCSS resources" -}}
  {{- end -}}
  {{- $options := (dict "enableSourceMap" true "compress" true "targetPath" "css/new-oldnew-mashup.css" "includePaths" (slice "assets/scss/oldnew" "assets/scss/normalize") ) -}}
  {{- $gsvresname := "css/oldnew-vars.scss" -}}
  {{- $gsv := resources.Get $gsvresname -}}
  {{- if not $gsv -}}
    {{- errorf "Missing SCSS style scheme resources" -}}
  {{- end -}}
  {{- $pregenstylesheetname := printf "css/oldnew-mashup/%s-oldnew-mashup.css" "new" -}}
  {{- $nbstyle := resources.Get $pregenstylesheetname -}}
  {{- if or (and ( eq (string hugo.Environment) "for-basic" ) ( not $.Site.IsServer )) (eq (string hugo.Environment) "development") -}}
    {{- $nbtplname := printf "css/hugo-%s-scheme.scss" "base" -}}
    {{- $nbtpl := $gsv | resources.ExecuteAsTemplate $nbtplname . -}}
    {{- $nbnmcatname := printf "css/%s-oldnew-mashup.scss" "cat" -}}
    {{- $nbnmcat := slice $nbtpl $nb | resources.Concat $nbnmcatname -}}
    {{- if and ( eq (string hugo.Environment) "for-basic" ) ( not $.Site.IsServer ) -}}
      {{- $nbstyle = $nbnmcat | resources.ToCSS $options -}}
    {{ else }}
      {{- $nbstyle = $nbnmcat | resources.ToCSS $options | resources.Fingerprint -}}
    {{ end }}
  {{- else -}}
    {{- if not $nbstyle -}}
      {{- errorf ( printf "Missing stylesheet '%s'" $pregenstylesheetname ) -}}
    {{- end -}}
    {{- $nbstyle = $nbstyle | resources.Fingerprint -}}
  {{- end -}}
  {{ if $nbstyle }}
  <link rel="stylesheet" href="{{ $nbstyle.Permalink }}"/>
  {{- end }}
{{ end }}
{{ block "output-formats" . }}
  {{ range .AlternativeOutputFormats -}}
    {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
  {{ end -}}
{{ end }}
{{ block "scripts" . }}
  {{ $fusejs := resources.Get "js/krisk-Fuse/dist/fuse.js" }}
  {{ $jmarkjs := resources.Get "js/julmot-mark/dist/mark.js" | resources.Minify }}
  {{ $search := resources.Get "js/search.js" | resources.Minify }}
  {{ $confirmation := resources.Get "js/confirmation.js" | resources.Minify }}
  <script src="{{ $fusejs.RelPermalink }}"></script>
  <script src="{{ $jmarkjs.RelPermalink }}"></script>
  <script>
    var indexurl = {{ "index.json" | absURL }}
  </script>
  <script src="{{ $search.RelPermalink }}"></script>
  <script src="{{ $confirmation.RelPermalink }}"></script>
{{ end }}
