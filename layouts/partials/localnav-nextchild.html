{{ $curPage := .Page.Scratch.Get "curPage" }}
{{ $children := where .Children ".Page" "ne" nil }}
{{ range $children }}
  {{ $matched := $curPage.Scratch.Get "match" }}
  {{ if ne $matched 2 }}
    {{ if eq $matched 1 }}
      {{ $curPage.Scratch.Set "nextPage" .Page }}
      {{ $curPage.Scratch.Set "match" 2 }}
    {{ else }}
      {{ if eq $curPage .Page }}
        {{ $curPage.Scratch.Set "match" 1 }}
      {{ else }}
        {{ if .HasChildren }}
          {{ .Page.Scratch.Set "curPage" $curPage }}
          {{ partial "localnav-nextchild" . }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}
