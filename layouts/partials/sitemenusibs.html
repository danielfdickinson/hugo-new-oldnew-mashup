  <!-- Copyright 2018 Daniel F. Dickinson,
       Released under the Creative Commons 4.0 BY (Attribution) License -->
{{ $hasSubmenu := .Scratch.Get "hasSubmenu" }}
{{ $basePage := .Scratch.Get "BasePage" }}
{{ range .Data.Pages }}
  {{ .Scratch.Set "BasePage" $basePage }}
  {{ .Scratch.Set "hasSubmenu" false }}
  {{ if (and (or (.InSection $basePage) (.IsPage ) ) (not (eq .Params.notinmenu true) ) ) }}
    {{ partial "sitemenuitem" . }}
  {{ end }}
{{ end}}
