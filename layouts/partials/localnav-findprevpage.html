{{ $curPage := . }}
{{ .Scratch.Set "lnfpPrevPage" nil }}
{{ if .NextInSection }}
  <a href="{{ .NextInSection.URL | relURL }}">Prev</a>
{{ else if .IsPage }}
  {{ if .Parent }}
    {{ with .Parent }}
      {{ if .Sections }}
        {{ range (first 1 .Sections) }}
          {{ .Scratch.Set "lnfpCurPage" $curPage }}
          {{ partial "localnav-findlastprev" . }}
        {{ end }}
      {{ else }}
         <a href ="{{ .URL | relURL }}">Prev</a>
      {{ end }}
    {{ else }}
       <a href ="{{ .Parent.URL | relURL }}">Prev</a>
    {{ end }}
  {{ else }}
    Prev
  {{ end }}
{{ else if .Parent }}
  {{ with .Parent }}
    {{ $curPage.Scratch.Set "lnfpPrevPage" nil }}
    {{ $curPage.Scratch.Set "lnfpCurPage" nil }}
    {{ $curPage.Scratch.Set "lnfpFoundPage" false }}
    {{ $parentPage := . }}
    {{ range .Sections }}
      {{ $curSection := . }}
      {{ with $curPage }}
        {{ .Scratch.Set "lnfpPrevPage" (.Scratch.Get "lnfpCurPage") }}
        {{ if eq . $curSection }}
          {{ .Scratch.Set "lnfpFoundPage" true }}
        {{ else if not (.Scratch.Get "lnfpFoundPage") }}
          {{ .Scratch.Set "lnfpCurPage" $curSection }}
        {{ end }}
      {{ end }}
    {{ end }}
    {{ $curPage.Scratch.Delete "lnfpCurPage" }}
    {{ $foundPage := ($curPage.Scratch.Get "lnfpFoundPage") }}
    {{ if and $foundPage ($curPage.Scratch.Get "lnfpPrevPage") }}
      {{ partial "localnav-findlastinsection" ($curPage.Scratch.Get "lnfpPrevPage") }}
    {{ else }}
      <a href ="{{ .URL | relURL }}">Prev</a>
    {{ end }}
    {{ $curPage.Scratch.Delete "lnfpFoundPage" }}
    {{ $curPage.Scratch.Delete "lnfpPrevPage" }}
  {{ end }}
{{ else }}
  Prev
{{ end }}
