  <!-- Copyright 2018 Daniel F. Dickinson,
       Released under the Creative Commons 4.0 BY (Attribution) License -->
{{ $curItem := . }}
{{ $currentPage := .Scratch.Get "currentPage" }}
{{ $maxLevel := .Scratch.Get "maxLevel" }}
{{ $prevLevel := .Scratch.Get "prevLevel" }}
{{ $curLevel := add $prevLevel 1 }}
{{ range .Data.Pages }}
  {{ .Scratch.Set "prevLevel" $prevLevel }}
  {{ .Scratch.Set "maxLevel" $maxLevel }}
  {{ .Scratch.Set "currentPage" $currentPage }}
  {{ if not .Sections }}
    {{ partial "menuitem" . }}
  {{ else }}
    {{ .Scratch.Set "hasSubmenu" true }}
    {{ .Scratch.Set "sections" .Sections }}
    {{ partial "menusub" . }}
    </ul><li>
  {{ end }}
{{ end}}
