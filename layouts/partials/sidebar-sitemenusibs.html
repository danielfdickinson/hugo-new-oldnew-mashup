  <!-- Copyright 2018 Daniel F. Dickinson,
       Released under the Creative Commons 4.0 BY (Attribution) License -->
{{ $maxLevel := .Scratch.Get "sidebarMaxLevel" }}
{{ $curLevel := .Scratch.Get "sidebarCurLevel" }}
{{ $nextLevel := add $curLevel 1 }}
{{ $nextSectionLevel := add $curLevel 2 }}
{{ $hasSubmenu := .Scratch.Get "hasSubmenu" }}
{{ $basePage := .Scratch.Get "BasePage" }}
{{ range .Data.Pages }}
  {{ $showItem := (not (eq .Params.notinmenu true) ) }}
  {{ $showPage := (and $showItem (or (and .IsPage (lt $curLevel $maxLevel) ) ) ) }}
  {{ .Scratch.Set "sidebarMaxLevel" $maxLevel }}
  {{ .Scratch.Set "sidebarCurLevel" $curLevel }}
  {{ .Scratch.Set "BasePage" $basePage }}
  {{ if $showPage }}
    {{ partial "sitemenuitem" . }}
  {{ end }}
{{ end}}
