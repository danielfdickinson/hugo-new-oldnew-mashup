{{ if .Page }}{{ $currentPage := .Page.Scratch.Get "currentPage" }}{{ $maxLevel := .Page.Scratch.Get "maxLevel" }}{{ $prevLevel := .Page.Scratch.Get "prevLevel" }}{{ $curLevel := add $prevLevel 1 }}{{ .Page.Scratch.Set "prevLevel" $curLevel }}<li class="{{ if $currentPage.IsMenuCurrent "site" . }}MenuActive {{ end }} MenuParent MenuItem">
  <!-- Copyright 2018 Daniel F. Dickinson,
       Released under the Creative Commons 4.0 BY (Attribution) License -->
        <a title="{{ .Title }}" href="{{ .URL | relURL }}">
          {{ .Pre }}
          <span class="MenuEntryName">{{ .Name }}</span>
          {{ .Post }}
        </a><ul class="MenuSubmenu">{{ range .Children }}{{ .Page.Scratch.Set "currentPage" $currentPage }}{{ .Page.Scratch.Set "maxLevel" $maxLevel }}{{ .Page.Scratch.Set "prevLevel" $curLevel }}{{ if .HasChildren }}{{ if lt $curLevel $maxLevel }}{{ partial "subsitemenu" . }}<li class="{{ if $currentPage.IsMenuCurrent "site" . }}MenuActive {{ end }} MenuParent MenuItem">
                  <a title="{{ .Title }}" href="{{ .URL | relURL }}">
                   {{ .Pre }}
                    <span class="MenuEntryName">{{ .Name }}</span>
                    {{ .Post }}
                  </a>
                </li>{{ else }}<li class="{{ if $currentPage.IsMenuCurrent "site" . }}MenuActive {{ end }} MenuParent MenuItem">
                  <a title="{{ .Title }}" href="{{ .URL | relURL }}">
                   {{ .Pre }}
                    <span class="MenuEntryName">{{ .Name }}</span>
                    {{ .Post }}
                  </a></li>{{ end }}{{ else }}<li class="{{ if $currentPage.IsMenuCurrent "site" . }}MenuActive {{ end }}MenuItem">
                <a title="{{ .Title }}" href="{{ .URL | relURL }}">
                  {{ .Pre }}
                  <span class="MenuEntryName">{{ .Name }}</span>
                  {{ .Post }}
                </a>
              </li>{{ end }}{{ end }}</ul></li>{{ $curLevel := sub $prevLevel 1 }}{{ .Page.Scratch.Set "prevLevel" $curLevel }}{{ else }}<li class="MenuParent MenuItem">
        <a title="{{ .Title }}" href="{{ .URL | relURL }}">
          {{ .Pre }}
          <span class="MenuEntryName">{{ .Name }}</span>
          {{ .Post }}
        </a><ul class="MenuSubmenu">{{ range .Children }}{{ if .HasChildren }}{{ partial "subsitemenu" . }}<li class="MenuParent MenuItem">
                  <a title="{{ .Title }}" href="{{ .URL | relURL }}">
                    {{ .Pre }}
                    <span class="MenuEntryName">{{ .Name }}</span>
                    {{ .Post }}
                  </a></li>{{ else }}<li class="MenuItem">
                <a title="{{ .Title }}" href="{{ .URL | relURL }}">
                  {{ .Pre }}
                  <span class="MenuEntryName">{{ .Name }}</span>
                  {{ .Post }}
                </a></li>{{ end }}{{ end }}</ul></li>{{ end }}
