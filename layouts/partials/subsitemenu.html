{{ if .Page }}{{ $currentPage := .Page.Scratch.Get "currentPage" }}{{ $maxLevel := .Page.Scratch.Get "maxLevel" }}{{ $prevLevel := .Page.Scratch.Get "prevLevel" }}{{ $curLevel := add $prevLevel 1 }}{{ $isCurrent := $currentPage.IsMenuCurrent "site" . }}{{ $hasCurrent := $currentPage.HasMenuCurrent "site" . }}<li class="{{ if or $isCurrent $hasCurrent }}MenuActive {{ end }} MenuParent MenuItem">
  <!-- Copyright 2018 Daniel F. Dickinson,
       Released under the Creative Commons 4.0 BY (Attribution) License -->
        <a title="{{ .Title }}" href="{{ .URL | relURL }}">
          {{ .Pre }}
          <span class="MenuEntryName">{{ .Name }}</span>
          {{ .Post }}
        </a>{{ $nextLevel := add $curLevel 1 }}{{ if le $nextLevel $maxLevel }}<ul class="MenuSubmenu">{{ range .Children }}{{ .Page.Scratch.Set "currentPage" $currentPage }}{{ .Page.Scratch.Set "maxLevel" $maxLevel }}{{ .Page.Scratch.Set "prevLevel" $curLevel }}{{ if le $curLevel $maxLevel }}{{ if .HasChildren }}{{ partial "subsitemenu" . }}{{ else }}<li class="{{ if $currentPage.IsMenuCurrent "site" . }}MenuActive {{ end }}MenuItem">
                <a title="{{ .Title }}" href="{{ .URL | relURL }}">
                  {{ .Pre }}
                  <span class="MenuEntryName">{{ .Name }}</span>
                  {{ .Post }}
                </a>
              </li>{{ end }}{{ end }}{{ end }}</ul>{{ end }}</li>{{ $curLevel := sub $prevLevel 1 }}{{ .Page.Scratch.Set "prevLevel" $curLevel }}{{ else }}<li class="MenuParent MenuItem">
        <a title="{{ .Title }}" href="{{ .URL | relURL }}">
          {{ .Pre }}
          <span class="MenuEntryName">{{ .Name }}</span>
          {{ .Post }}
        </a><ul class="MenuSubmenu">{{ range .Children }}{{ if .HasChildren }}{{ partial "subsitemenu" . }}{{ else }}<li class="MenuItem">
                <a title="{{ .Title }}" href="{{ .URL | relURL }}">
                  {{ .Pre }}
                  <span class="MenuEntryName">{{ .Name }}</span>
                  {{ .Post }}
                </a></li>{{ end }}{{ end }}</ul></li>{{ end }}
