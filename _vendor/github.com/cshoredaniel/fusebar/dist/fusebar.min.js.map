{"version":3,"file":"fusebar.min.js","sources":["../src/index.js"],"sourcesContent":["/* global indexurl Fuse */\n\nvar summaryInclude = 1000\nvar fuseOptions = { // See Fuse.js for details\n  distance: 1000,\n  findAllMatches: true,\n  shouldSort: true,\n  includeMatches: true,\n  minMatchCharLength: 1,\n  threshold: 0.5,  // default of 0.6 matches too much\n  tokenize: false,\n  keys: [{\n    name: 'title',\n    weight: 0.3\n  },\n  {\n    name: 'content',\n    weight: 0.4\n  },\n  {\n    name: 'tags',\n    weight: 0.1\n  },\n  {\n    name: 'categories',\n    weight: 0.1\n  }\n  ]\n}\n\nfunction doCloseSearch() { // eslint-disable-line no-unused-vars\n  if (document.getElementById('search-results')) {\n    document.getElementById('search-results').style = 'display: none; visibility: hidden;'\n    document.getElementById('search-results').innerHTML = '<h2>Search Results</h2>'\n  }\n}\n\nfunction doSearch() { // eslint-disable-line no-unused-vars\n  var searchQuery = document.search_form.s.value\n  if (searchQuery) {\n    if (document.getElementById('search-query')) {\n      document.getElementById('search-results').innerHTML = '<h2>Search Results</h2>'\n\n      document.getElementById('search-results').style = 'display: block; visibility: visible;'\n      var searchFuseOptions = fuseOptions\n      searchFuseOptions.minMatchCharLength = searchQuery.length * 0.8\n      executeSearch(searchQuery, searchFuseOptions)\n    }\n  } else {\n    var para = document.createElement('p')\n    para.innerText = 'Please enter a word or phrase above'\n    if (document.getElementById('search-results')) {\n      document.getElementById('search-results').appendChild(para)\n      document.getElementById('search-results').style = 'display: block; visibility: visible;'\n    }\n  }\n  return false\n}\n\nfunction executeSearch(searchQuery, searchFuseOptions) {\n  var request = new XMLHttpRequest()\n  request.open('GET', indexurl, true)\n  request.onload = function () {\n    if (request.status >= 200 && request.status < 400) {\n      var jsonprep = request.responseText.replace(/$/, ' ')\n      var pages = JSON.parse(jsonprep)\n      var fuse = new Fuse(pages, searchFuseOptions)\n      var result = fuse.search(searchQuery)\n      if (result.length > 0) {\n        populateResults(result, searchQuery)\n      } else {\n        var para = document.createElement('p')\n        para.innerHTML = 'No matches found'\n        document.getElementById('search-results').appendChild(para)\n      }\n    } else {\n      console.log('fusebar had error ' + request.status + ' on ' + indexurl)\n    }\n  }\n  request.onerror = function () {\n    console.log('fusebar search connection error ' + request.status)\n  }\n  request.send()\n}\n\nfunction createMark(value) {\n  var markel = document.createElement('mark')\n  var spanel = document.createElement('span')\n  spanel.setAttribute('class', 'mark')\n  spanel.innerHTML = value\n  markel.appendChild(spanel)\n\n  return markel\n}\n\nfunction markMatches(matches) {\n  var newResult = {}\n  matches.forEach(function (items, num) { // eslint-disable-line no-unused-vars\n    var newElement = document.createElement('div')\n\n    var prevIndexEnd = 0\n\n    items.indices.forEach(function (indexpair, indexnum) { // eslint-disable-line no-unused-vars\n      if (items.key == 'content' && items.value.length > summaryInclude) {\n        items.value = items.value.substring(0, summaryInclude)\n      }\n\n      var matchString = items.value.substring(indexpair[0], indexpair[1] + 1)\n      if (indexpair[0] >= prevIndexEnd) {\n        var newSubString = document.createElement('span')\n        newSubString.innerHTML = items.value.substring(prevIndexEnd, indexpair[0])\n        newElement.appendChild(newSubString)\n      }\n\n      newElement.appendChild(createMark(matchString))\n\n      prevIndexEnd = indexpair[1] + 1\n    })\n\n    if ((prevIndexEnd) < items.value.length) {\n      newElement.appendChild(\n        document.createTextNode(\n          items.value.substring(prevIndexEnd, items.value.length)\n        )\n      )\n    }\n\n    newResult[items.key] = {\n      'element': newElement,\n      'original_value': items.value\n    }\n  })\n\n  return newResult\n}\n\nfunction populateResults(results, searchQuery) { // eslint-disable-line no-unused-vars\n  results.forEach(function (result, resnum) { // eslint-disable-line no-unused-vars\n    var resultElement = document.createElement('div')\n    resultElement.setAttribute('class', 'search-result')\n    resultElement.id = 'search-result-' + resnum.toString()\n    if (result.item.content && result.item.content.length > summaryInclude) {\n      result.item.content = result.item.content.substring(0, summaryInclude)\n    }\n    var resultMap = markMatches(result.matches)\n    var resultKeys = ['Title', 'Content', 'Tags', 'Categories']\n    resultKeys.forEach(function (key) {\n\n      var lowerKey = key.toString().toLowerCase()\n      var keyElement\n      var resultTitleLink\n\n      if (lowerKey == 'title') {\n        keyElement = document.createElement('h4')\n        keyElement.setAttribute('class', 'search-result-title')\n        resultTitleLink = document.createElement('a')\n        resultTitleLink.setAttribute('href', result.item.permalink)\n      }\n\n      if (typeof resultMap[lowerKey] !== 'undefined') {\n        if (lowerKey == 'title') {\n          resultTitleLink.innerHTML = resultMap[lowerKey].element.innerHTML\n          if (!resultMap[lowerKey].element.innerHTML || resultMap[lowerKey].element.innerHTML == '') {\n            resultTitleLink.innnerHTML = 'Untitled'\n          }\n        } else if (lowerKey == 'content') {\n          keyElement = resultMap.content.element\n          keyElement.setAttribute('class', 'search-result-content')\n        } else {\n          var keyElVal\n          keyElement = document.createElement('div')\n          keyElement.setAttribute('class', 'search-result-' + lowerKey)\n          keyElement.appendChild(document.createTextNode(key + ':  '))\n          var firstVal = true\n          result.item[lowerKey].forEach(function (tcval, tckey) { // eslint-disable-line no-unused-vars\n            if (!firstVal) {\n              keyElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            if (tcval == resultMap[lowerKey].original_value) {\n              keyElVal = document.createElement('span')\n              keyElVal.innerHTML = resultMap[lowerKey].element.innerHTML\n\n            } else {\n              keyElVal = document.createElement('span')\n              keyElVal.innerHTML = tcval\n            }\n\n            keyElement.appendChild(keyElVal)\n          })\n        }\n      } else {\n        if (lowerKey == 'title') {\n          resultTitleLink.innerHTML = result.item.title\n          if (!result.item.title || result.item.title == '') {\n            resultTitleLink.innerHTML = 'Untitled'\n          }\n        } else if (lowerKey == 'content') {\n          if (result.item.content && (result.item.content != '')) {\n            keyElement = document.createElement('div')\n            keyElement.innerHTML = result.item.content\n          }\n        } else if (result.item[lowerKey]) {\n          keyElement = document.createElement('div')\n          keyElement.setAttribute('class', 'search-result-' + lowerKey)\n          keyElement.appendChild(document.createTextNode(key + ':  '))\n          firstVal = true\n          result.item[lowerKey].forEach(function (tcval, tckey) { // eslint-disable-line no-unused-vars\n            if (!firstVal) {\n              keyElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            var keyElVal = document.createElement('span')\n            keyElVal.innerHTML = tcval\n            keyElement.appendChild(keyElVal)\n          })\n        }\n      }\n\n      if (lowerKey == 'title') {\n        keyElement.appendChild(resultTitleLink)\n      }\n\n      if (typeof keyElement !== 'undefined') {\n        resultElement.appendChild(keyElement)\n      }\n    })\n\n    document.getElementById('search-results').appendChild(resultElement)\n  })\n\n  return true\n}\n\nexport {\n  doCloseSearch,\n  doSearch,\n  executeSearch,\n  createMark,\n  markMatches,\n  populateResults\n}\n"],"names":["fuseOptions","distance","findAllMatches","shouldSort","includeMatches","minMatchCharLength","threshold","tokenize","keys","name","weight","executeSearch","searchQuery","searchFuseOptions","request","XMLHttpRequest","open","indexurl","onload","status","jsonprep","responseText","replace","pages","JSON","parse","result","Fuse","search","length","populateResults","para","document","createElement","innerHTML","getElementById","appendChild","console","log","onerror","send","createMark","value","markel","spanel","setAttribute","markMatches","matches","newResult","forEach","items","num","newElement","prevIndexEnd","indices","indexpair","indexnum","key","substring","matchString","newSubString","createTextNode","results","resnum","resultElement","id","toString","item","content","resultMap","keyElement","resultTitleLink","lowerKey","toLowerCase","permalink","element","innnerHTML","keyElVal","firstVal","tcval","tckey","original_value","title","style","search_form","s","innerText"],"mappings":"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"}