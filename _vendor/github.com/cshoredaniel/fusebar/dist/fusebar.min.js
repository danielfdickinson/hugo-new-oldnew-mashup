/**
 * fusebar.js v0.2.2 - Private website search for browsers using Fuse.js as backend (https://www.thecshore.com/projects/fusebar)
 *
 * Copyright (c) 2020 Daniel F. Dickinson (https://www.thecshore.com)
 * All Rights Reserved. Apache Software License 2.0
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).fusebar={})}(this,(function(e){"use strict";var t={distance:1e3,findAllMatches:!0,shouldSort:!0,includeMatches:!0,minMatchCharLength:1,threshold:.5,tokenize:!1,keys:[{name:"title",weight:.3},{name:"content",weight:.4},{name:"tags",weight:.1},{name:"categories",weight:.1}]};function n(e,t){var n=new XMLHttpRequest;n.open("GET",indexurl,!0),n.onload=function(){if(n.status>=200&&n.status<400){var r=n.responseText.replace(/$/," "),a=JSON.parse(r),s=new Fuse(a,t).search(e);if(s.length>0)i(s);else{var l=document.createElement("p");l.innerHTML="No matches found",document.getElementById("search-results").appendChild(l)}}else console.log("fusebar had error "+n.status+" on "+indexurl)},n.onerror=function(){console.log("fusebar search connection error "+n.status)},n.send()}function r(e){var t=document.createElement("mark"),n=document.createElement("span");return n.setAttribute("class","mark"),n.innerHTML=e,t.appendChild(n),t}function a(e){var t={};return e.forEach((function(e,n){var a=document.createElement("div"),i=0;e.indices.forEach((function(t,n){"content"==e.key&&e.value.length>1e3&&(e.value=e.value.substring(0,1e3));var s=e.value.substring(t[0],t[1]+1);if(t[0]>=i){var l=document.createElement("span");l.innerHTML=e.value.substring(i,t[0]),a.appendChild(l)}a.appendChild(r(s)),i=t[1]+1})),i<e.value.length&&a.appendChild(document.createTextNode(e.value.substring(i,e.value.length))),t[e.key]={element:a,original_value:e.value}})),t}function i(e,t){return e.forEach((function(e,t){var n=document.createElement("div");n.setAttribute("class","search-result"),n.id="search-result-"+t.toString(),e.item.content&&e.item.content.length>1e3&&(e.item.content=e.item.content.substring(0,1e3));var r=a(e.matches);["Title","Content","Tags","Categories"].forEach((function(t){var a,i,s=t.toString().toLowerCase();if("title"==s&&((a=document.createElement("h4")).setAttribute("class","search-result-title"),(i=document.createElement("a")).setAttribute("href",e.item.permalink)),void 0!==r[s])if("title"==s)i.innerHTML=r[s].element.innerHTML,r[s].element.innerHTML&&""!=r[s].element.innerHTML||(i.innnerHTML="Untitled");else if("content"==s)(a=r.content.element).setAttribute("class","search-result-content");else{var l;(a=document.createElement("div")).setAttribute("class","search-result-"+s),a.appendChild(document.createTextNode(t+":  "));var c=!0;e.item[s].forEach((function(e,t){c?c=!1:a.appendChild(document.createTextNode(", ")),e==r[s].original_value?(l=document.createElement("span")).innerHTML=r[s].element.innerHTML:(l=document.createElement("span")).innerHTML=e,a.appendChild(l)}))}else"title"==s?(i.innerHTML=e.item.title,e.item.title&&""!=e.item.title||(i.innerHTML="Untitled")):"content"==s?e.item.content&&""!=e.item.content&&((a=document.createElement("div")).innerHTML=e.item.content):e.item[s]&&((a=document.createElement("div")).setAttribute("class","search-result-"+s),a.appendChild(document.createTextNode(t+":  ")),c=!0,e.item[s].forEach((function(e,t){c?c=!1:a.appendChild(document.createTextNode(", "));var n=document.createElement("span");n.innerHTML=e,a.appendChild(n)})));"title"==s&&a.appendChild(i),void 0!==a&&n.appendChild(a)})),document.getElementById("search-results").appendChild(n)})),!0}e.createMark=r,e.doCloseSearch=function(){document.getElementById("search-results")&&(document.getElementById("search-results").style="display: none; visibility: hidden;",document.getElementById("search-results").innerHTML="<h2>Search Results</h2>")},e.doSearch=function(){var e=document.search_form.s.value;if(e){if(document.getElementById("search-query")){document.getElementById("search-results").innerHTML="<h2>Search Results</h2>",document.getElementById("search-results").style="display: block; visibility: visible;";var r=t;r.minMatchCharLength=.8*e.length,n(e,r)}}else{var a=document.createElement("p");a.innerText="Please enter a word or phrase above",document.getElementById("search-results")&&(document.getElementById("search-results").appendChild(a),document.getElementById("search-results").style="display: block; visibility: visible;")}return!1},e.executeSearch=n,e.markMatches=a,e.populateResults=i,Object.defineProperty(e,"__esModule",{value:!0})}));
